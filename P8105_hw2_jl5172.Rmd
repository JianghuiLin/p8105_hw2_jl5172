---
title: "P8105_hw2_jl5172"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

```{r}

nyctransit = read.csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv")
nyctransit = janitor::clean_names(nyctransit)
```

#Q1
#Read and clean the data; retain line, station, name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance. 

#Convert the entry variable from character (YES vs NO) to a logical variable (the ifelse or recode function may be useful).
```{r}
nycsubset1<-select(nyctransit,line,station_name,station_latitude,station_longitude,route1,route2,route3,route4,route5,route6,route7,route8,route9,route10,route11,entry,vending,entrance_type,ada)


```

```{r}
recode(nycsubset1$entry,"YES"=TRUE,"NO"=FALSE)
```

#Write a short paragraph about this dataset – explain briefly what variables the dataset contains, describe your data cleaning steps so far, and give the dimension (rows x columns) of the resulting dataset. Are these data tidy?

#the dimension of cleaned dataset is 1868rows*19columns. The three reuqirements for tidy data are 1.Columns are variables. 2.Rows are observations 3.Every value has a cell.This dataset-nycsubset1 is not cosidered because not every value has a cell.


```{r}
nycdistinct<-distinct(nycsubset1,nycsubset1$station_name,nycsubset1$line,.keep_all = TRUE)
nrow(nycdistinct)
sum(nycdistinct$ada)
```

```{r}
entrancenoven<-filter(nycdistinct,entry=="YES" & vending=="NO")
nrow(entrancenoven)
```

Answer the following questions using these data:

How many distinct stations are there? 
# There are 465 distinct stations here.
# 
How many stations are ADA compliant? 
#84 stations are ADA compliant

What proportion of station entrances / exits without vending allow entrance?
5/465=0.1075269

 
```{r}
routedistinct<-distinct(nycsubset1,nycsubset1$station_name,nycsubset1$line,.keep_all = TRUE)
```

Reformat data so that route number and route name are distinct variables.
```{r}
gatherbindnyc<-gather(nycsubset1, key = routes, value=train,route1:route11,na.rm = TRUE)

```

How many distinct stations serve the A train? Of the stations that serve the A train, 60
# 60 stations serve A train

```{r}
serveA<-filter(gatherbindnyc,train=="A")
serveA<-distinct(serveA,serveA$station_name,serveA$line)
nrow(serveA)
```

how many are ADA compliant?
# 84 stations are ADA compliant.
```{r}
ADA<-filter(gatherbindnyc,ada=="TRUE")
ADA<-distinct(ADA,ADA$station_name,ADA$line)
nrow(ADA)
```


```{r}
water<-readxl::read_xlsx("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx")
```


```{r}
#character.data$z = ifelse(is.na(character.data$x),
                           #character.data$y,character.data$x)
```


```{r}
#nycdistinct$route1<-ifelse(is.na(nyctransit$route1,nyctransit$route2,nyctransit$route3,nyctransit$route4,nyctransit$route5,nyctransit$route6,nyctransit$route7,nyctransit$route8,nyctransit$route8,nyctransit$route9,nyctransit$route10,nyctransit$route11))
```

Read and clean the Mr. Trash Wheel sheet:

specify the sheet in the Excel file and to omit columns containing notes (using the range argument and  cell_cols() function)
use reasonable variable names
omit rows that do not include dumpster-specific data
rounds the number of sports balls to the nearest integer and converts the result to an integer variable (using  as.integer)
```{r}
library(readxl)
water<-read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx",sheet = 1,range = "A2:N338")
water<-filter(water,!is.na(water$Dumpster))
as.integer(round(water$`Sports Balls`))
```

Read and clean precipitation data for 2016 and 2017. For each, omit rows without precipitation data and add a variable year. Next, combine datasets and convert month to a character variable (the variable month.name is built into R and should be useful).
janitor clean name
```{r}
ppt_2017<-read_xlsx("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = 4,range = "A2:B15")
ppt_2016<-read_xlsx("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = 5,range = "A2:B15")
ppt_2017<-janitor::clean_names(ppt_2017)
ppt_2016<-janitor::clean_names(ppt_2016)
```


```{r}

ppt_2017<-filter(ppt_2017,!is.na(ppt_2017$total)&!is.na(ppt_2017$month))
ppt_2017<-mutate(ppt_2017,year=2017)

ppt_2016<-filter(ppt_2016,!is.na(ppt_2016$total)&!is.na(ppt_2016$month))
ppt_2016<-mutate(ppt_2016,year=2016)

ppt_1617<-rbind(ppt_2016,ppt_2017)
ppt_1617<-mutate(ppt_1617,month=month.name[month])
```

```{r}
ppt_1617<-mutate(ppt_1617,month=month.name[month])
```

Write a paragraph about these data; you are encouraged to use inline R. Be sure to note the number of observations in both resulting datasets, and give examples of key variables.
# Based on my observations,'Date'and 'Month' are considered the most important variable variables in the datasets. The amount of precipitation changed as the date goes by and we can see a pattern that precipitation amount is relatively high during summer time and low during winter time.

For available data, what was the total precipitation in 2017? 
#32.93

```{r}
sum(ppt_2017$total)

```
What was the median number of sports balls in a dumpster in 2016?
# median is 26.
```{r}
water_2016<-filter(water,Year=="2016")
median(water_2016$`Sports Balls`)
```


Question 3 starts here
```{r}
devtools::install_github("p8105/p8105.datasets")
library(p8105.datasets)
data("brfss_smart2010")

```

For this question:

format the data to use appropriate variable names;
focus on the “Overall Health” topic

```{r}
brfss<-janitor::clean_names(brfss_smart2010)
brfss<-filter(brfss,topic == "Overall Health")

```


exclude variables for class, topic,question,sample size, and everything from lower confidence limit to GeoLocation
```{r}
brfss<-select(brfss,year,locationabbr,locationdesc,response,data_value)

```

```{r}
brfss<-spread(brfss,key=response,value = data_value)
brfss<-mutate(brfss,excellentgood=(Excellent+`Very good`)/100)
```


structure data so that values for Response (“Excellent” to “Poor”) are column names / variables which indicate the proportion of subjects with each response (which are values of Data_value in the original dataset)
create a new variable showing the proportion of responses that were “Excellent” or “Very Good”


How many unique locations are included in the dataset? # 404 distinct locations

Is every state represented?  Yes, there are 51 states which have been represented



```{r}
uniquelocations<-nrow(distinct(brfss,locationdesc))
uniquelocations
uniquestates<-nrow(distinct(brfss,locationabbr))
uniquestates


```


What state is observed the most?
```{r}
statemost<-brfss %>% 
  group_by(locationabbr) %>% 
  summarise(number=n()) 
filter(statemost,statemost$number== max(statemost$number))

```

In 2002, what is the median of the “Excellent” response value? 
# Median is 23.6
```{r}
brfss_2002<-filter(brfss,year==2002)
median(brfss_2002$Excellent,na.rm=TRUE)
```




Make a histogram of “Excellent” response values in the year 2002.
```{r}
brfss_2002 %>% 
  ggplot(aes(x = Excellent))+
  geom_histogram()
# x-axis is the proportion of excellent
# y-axis is the number of locations.
  
```

Make a scatterplot showing the proportion of “Excellent” response values in New York County and Queens County (both in NY State) in each year from 2002 to 2010.
```{r}
NYC_QC_2002_2010<-filter(brfss,locationdesc=="NY - New York County"|locationdesc=="NY - Queens County")

NYC_QC_2002_2010 %>% 
  ggplot(aes(x = locationdesc, y= Excellent ,color =locationdesc))+
  geom_point()

```


```{r}
NYC_QC_2002_2010 %>% 
  ggplot(aes(x = Excellent, y= locationdesc ,color =locationdesc))+
  geom_point()
```




brfss %>%
  group_by(name, month) %>%
  summarize(mean_tmax = mean(tmax)) %>%
  ggplot(aes(x = month, y = mean_tmax, color = name)) + 
    geom_point() + geom_line() + 
    theme(legend.position = "bottom")
